<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hanfu.user.center.dao.HfCouponMapper">
  <resultMap id="BaseResultMap" type="com.hanfu.user.center.model.HfCoupon">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jan 07 14:58:38 CST 2020.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="money" jdbcType="INTEGER" property="money" />
    <result column="total" jdbcType="INTEGER" property="total" />
    <result column="body" jdbcType="VARCHAR" property="body" />
    <result column="status" jdbcType="INTEGER" property="status" />
  </resultMap>


  <select id="selectCoupon" resultType="com.hanfu.user.center.model.HfCoupon">
        select * from hf_coupon
      <if test="id != null ">
          where id = #{id,jdbcType=INTEGER}
      </if>
  </select>

  <insert id="insertCoupon">
        insert into hf_coupon(money,total,body,status) values(#{money,jdbcType=INTEGER},#{total,jdbcType=INTEGER},#{body,jdbcType=VARCHAR},1)
  </insert>

  <update id="updateCoupon">
        update hf_coupon
            <set>
                <if test="money != null ">
                    money = #{money,jdbcType=INTEGER},
                </if>
                <if test="total != null ">
                    total = #{total,jdbcType=INTEGER},
                </if>
                <if test="body != null ">
                    body = #{body,jdbcType=VARCHAR}
                </if>
            </set>
        where id = #{id,jdbcType=INTEGER}
  </update>

  <delete id="deleteCoupon">
     delete from hf_coupon
    <where>
      <if test="id != null">
        id = #{id,jdbcType=INTEGER}
      </if>
    </where>
  </delete>

    <!-- 用户查询自己的优惠券 -->
    <select id="selectUserCoupon" resultType="com.hanfu.user.center.model.HfUserCoupon">
        select * from hf_user_coupon where user_id = #{userId,jdbcType=INTEGER}
    </select>

    <!-- 用户领取优惠券 -->
    <insert id="receiveCoupon">
        insert into hf_user_coupon(user_id,coupon_id,create_time) values(
        #{userId,jdbcType=INTEGER},#{couponId,jdbcType=TIMESTAMP},#{time,jdbcType=TIMESTAMP}
        )
    </insert>

    <!-- 查询当前用户要用的优惠券信息 -->
    <select id="selectOneCoupon" resultType="com.hanfu.user.center.model.HfCoupon">
        select * from hf_coupon
        where
        <if test="couponId != null">
            id = #{couponId,jdbcType=INTEGER}
        </if>
    </select>

    <!-- 用户使用优惠券之后删除优惠券 -->
    <delete id="deleteUserCoupon" parameterType="java.lang.Integer">
        delete from hf_user_coupon
        <where>
            <if test="userId != null">
                user_id = #{userId,jdbcType=INTEGER}
            </if>
            <if test="couponId != null">
                AND coupon_id = #{couponId,jdbcType=INTEGER}
            </if>
            <if test="id != null">
                AND id = #{id,jdbcType=INTEGER}
            </if>
        </where>
    </delete>

</mapper>